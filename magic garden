import pygame
import random
import sys
import time
import json 
import os 

# --- GLOBAL SETUP ---
pygame.init()
pygame.mixer.init()

WIDTH, HEIGHT = 800, 600
screen = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("ğŸŒ± Magic Garden â€“ Start Screen")

# ----------- COLORS (Î§Î¡Î©ÎœÎ‘Î¤Î‘) ------------
WHITE = (255,255,255)
BLACK = (0,0,0)
GREEN = (70,200,90)
LIGHT_BLUE = (140,200,255)
RED = (255,100,100)
PURPLE = (180,140,255)
DARK_PURPLE = (80, 50, 150)
LIGHT_GREY = (220, 220, 220)
GOLD = (255, 215, 0) 

# ----------- FONTS (Î“Î¡Î‘ÎœÎœÎ‘Î¤ÎŸÎ£Î•Î™Î¡Î•Î£) ------------
font = pygame.font.SysFont("Comic Sans MS", 36)
big_font = pygame.font.SysFont("Comic Sans MS", 50)
small_font = pygame.font.SysFont("Comic Sans MS", 26)
# **Î”Î™ÎŸÎ¡Î˜Î©Î£Î— AVATAR:** Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Segoe UI Emoji Î³Î¹Î± Windows
avatar_font = pygame.font.SysFont("Segoe UI Emoji", 40) 

# ----------- AVATARS & DATA ------------
AVATAR_ICONS = ["ğŸŒ±", "ğŸ‘¦", "ğŸ‘§", "ğŸ¸", "ğŸ§š"]
DEFAULT_PLANT_LEVEL = 0
DEFAULT_SCORE = 0
DEFAULT_STREAK = 0

# --- Î”Î™Î‘Î”Î¡ÎŸÎœÎ— Î‘Î¡Î§Î•Î™ÎŸÎ¥ Î•Î™ÎšÎŸÎÎ‘Î£ ---
try:
    BACKGROUND_IMAGE = pygame.image.load("magic_garden.png").convert() 
    BACKGROUND_IMAGE = pygame.transform.scale(BACKGROUND_IMAGE, (WIDTH, HEIGHT))
except pygame.error:
    print("Î”Î•Î Î’Î¡Î•Î˜Î—ÎšÎ• Î— Î•Î™ÎšÎŸÎÎ‘ Î¦ÎŸÎÎ¤ÎŸÎ¥. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï‡ÏÏÎ¼Î±.")
    BACKGROUND_IMAGE = None

# --- Î‘Î¡Î§Î•Î™Î‘ Î‘Î ÎŸÎ˜Î—ÎšÎ•Î¥Î£Î—Î£ ---
SAVE_FILE = "garden_save.json"

# ----------- SOUNDS (Î—Î§ÎŸÎ™) ------------
try:
    sound_correct = pygame.mixer.Sound("C:/Windows/Media/Windows Ding.wav")
    sound_wrong = pygame.mixer.Sound("C:/Windows/Media/Windows Error.wav")
except pygame.error as e:
    print(f"âš ï¸ Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ Î®Ï‡Ï‰Î½ Ï„Ï‰Î½ Windows: {e}")
    sound_correct = pygame.mixer.Sound(size=22050)
    sound_wrong = pygame.mixer.Sound(size=22050)

# ---------------------------------------------------------
# ğŸŸ¢ UTILS (Î’ÎŸÎ—Î˜Î—Î¤Î™ÎšÎ•Î£ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£)
# ---------------------------------------------------------

def load_progress():
    """Î¦Î¿ÏÏ„ÏÎ½ÎµÎ¹ Ï„Î·Î½ Ï€ÏÏŒÎ¿Î´Î¿ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï€Î±Î¹ÎºÏ„ÏÎ½."""
    try:
        with open(SAVE_FILE, 'r', encoding='utf-8') as f:
            return json.load(f)
    except (FileNotFoundError, json.JSONDecodeError):
        return {} 

def save_progress(data):
    """Î‘Ï€Î¿Î¸Î·ÎºÎµÏÎµÎ¹ Ï„Î·Î½ Ï€ÏÏŒÎ¿Î´Î¿ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï€Î±Î¹ÎºÏ„ÏÎ½."""
    try:
        with open(SAVE_FILE, 'w', encoding='utf-8') as f:
            json.dump(data, f, indent=4, ensure_ascii=False)
    except IOError as e:
        print(f"Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·: {e}")

def draw_text_center(surf, text, y, font, color=BLACK, x=WIDTH // 2):
    label = font.render(text, True, color)
    rect = label.get_rect(center=(x, y))
    surf.blit(label, rect)

def draw_text(surf, text, pos, font, color): 
    label = font.render(text, True, color)
    surf.blit(label, pos)

# ---------------------------------------------------------
# ğŸŸ¢ UI ELEMENTS (Î£Î¤ÎŸÎ™Î§Î•Î™Î‘ UI) - FancyButton Ï€Î±ÏÎ±Î¼Î­Î½ÎµÎ¹ Î¯Î´Î¹Î±
# ---------------------------------------------------------

class FancyButton:
    def __init__(self, text, x, y, w, h, base_color, hover_color, action=None):
        self.text = text
        self.base_rect = pygame.Rect(x, y, w, h)
        self.rect = self.base_rect.copy()
        self.base_color = base_color
        self.hover_color = hover_color
        self.action = action
        self.is_hovered = False

    def draw(self, surf):
        mouse_pos = pygame.mouse.get_pos()
        self.is_hovered = self.base_rect.collidepoint(mouse_pos)

        scale = 1.0
        if self.is_hovered:
            scale = 1.05
        
        new_w = int(self.base_rect.width * scale)
        new_h = int(self.base_rect.height * scale)
        self.rect.width = new_w
        self.rect.height = new_h
        self.rect.center = self.base_rect.center

        current_color = self.hover_color if self.is_hovered else self.base_color
        
        pygame.draw.rect(surf, current_color, self.rect, border_radius=15)
        pygame.draw.rect(surf, DARK_PURPLE, self.rect, 4, border_radius=15)

        label = font.render(self.text, True, BLACK)
        text_rect = label.get_rect(center=self.rect.center)
        surf.blit(label, text_rect)

    def check(self, pos):
        return self.base_rect.collidepoint(pos)


# ---------------------------------------------------------
# ğŸŸ¢ LOGIN SCREEN CLASS (Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—ÎœÎ•ÎÎ—)
# ---------------------------------------------------------

class LoginScreen:
    def __init__(self, players_data):
        self.players_data = players_data
        self.login_text = ""
        self.error_message = ""
        self.selected_avatar = 0 
        
        # ÎšÎ¿Ï…Î¼Ï€Î¯ START/Î£Î¥ÎÎ•Î§Î•Î™Î‘
        self.start_button = FancyButton(
            "START / Î£Ï…Î½Î­Ï‡Î¹ÏƒÎµ", 
            WIDTH // 2 - 150, 
            280, 
            300, 
            60, 
            GREEN, 
            LIGHT_BLUE
        )
        
        # **ÎÎ•ÎŸ:** ÎšÎ¿Ï…Î¼Ï€Î¯ Î•ÎÎŸÎ”ÎŸÎ¥
        self.quit_button = FancyButton(
            "ğŸšª ÎˆÎ¾Î¿Î´Î¿Ï‚", 
            WIDTH // 2 - 150, 
            350, 
            300, 
            60, 
            RED, 
            (255, 150, 150)
        )
        
        # ÎŸÏÎ¸Î¿Î³ÏÎ½Î¹Î± Î³Î¹Î± Ï„Î± avatars
        self.avatar_rects = []
        x_start = WIDTH // 2 - (len(AVATAR_ICONS) * 60) // 2 + 10
        for i in range(len(AVATAR_ICONS)):
            self.avatar_rects.append(pygame.Rect(x_start + i * 60, 210, 50, 50))
        
        self.running = True

    def draw_card(self, surf, rect, color):
        shadow_rect = rect.copy()
        shadow_rect.y += 5
        pygame.draw.rect(surf, BLACK, shadow_rect, border_radius=10) 
        pygame.draw.rect(surf, color, rect, border_radius=10)
        pygame.draw.rect(surf, DARK_PURPLE, rect, 3, border_radius=10) 

    def draw_scores_card(self, surf):
        card_rect = pygame.Rect(50, 420, WIDTH - 100, 150)
        self.draw_card(surf, card_rect, LIGHT_GREY)
        
        draw_text_center(surf, "ğŸ“œ Î¥Ï€Î¬ÏÏ‡Î¿Î½Ï„ÎµÏ‚ Î Î±Î¯ÎºÏ„ÎµÏ‚", 440, font, DARK_PURPLE, card_rect.centerx)

        y = 480
        sorted_players = sorted(self.players_data.items(), 
                                key=lambda item: item[1].get('score', 0), 
                                reverse=True)

        for name, data in sorted_players[:4]: 
            # Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Ï„Î·Î½ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Î³ÏÎ±Î¼Î¼Î±Ï„Î¿ÏƒÎµÎ¹ÏÎ¬ Î³Î¹Î± Ï„Î¿ avatar
            icon = avatar_font.render(AVATAR_ICONS[data.get('avatar', 0)], True, BLACK)
            text = small_font.render(f"{name} â€” Î£ÎºÎ¿Ï: {data.get('score', 0)}", True, BLACK)
            
            # Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î¸Î­ÏƒÎ·Ï‚
            total_width = icon.get_width() + text.get_width() + 10 # 10 pixels spacing
            start_x = card_rect.centerx - total_width // 2
            
            surf.blit(icon, (start_x, y - 5))
            surf.blit(text, (start_x + icon.get_width() + 10, y))
            y += 30

    def draw(self, surf):
        # Î¦ÏŒÎ½Ï„Î¿
        if BACKGROUND_IMAGE:
            surf.blit(BACKGROUND_IMAGE, (0, 0))
        else:
            surf.fill((230,245,255))
        
        draw_text_center(surf, "ğŸŒ± ÎšÎ±Î»ÏÏ‚ Î‰ÏÎ¸ÎµÏ‚ ÏƒÏ„Î¿ Magic Garden!", 50, big_font, DARK_PURPLE)

        # Input Card (Î£Î¼Î¯ÎºÏÏ…Î½ÏƒÎ· ÎºÎ¬ÏÏ„Î±Ï‚ Î³Î¹Î± Î½Î± Ï‡Ï‰ÏÎ­ÏƒÎµÎ¹ Ï„Î¿ Quit Button)
        input_card_rect = pygame.Rect(WIDTH//2 - 200, 100, 400, 320)
        self.draw_card(surf, input_card_rect, WHITE)
        
        # ÎŸÎ´Î·Î³Î¯Î±
        draw_text_center(surf, "1. Î“ÏÎ¬ÏˆÎµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ¿Ï…:", 125, font, BLACK)
        
        # Input Box
        input_rect = pygame.Rect(WIDTH//2 - 150, 150, 300, 40)
        pygame.draw.rect(surf, LIGHT_GREY, input_rect, border_radius=8)
        pygame.draw.rect(surf, BLACK, input_rect, 2, border_radius=8)

        name_label = small_font.render(self.login_text, True, BLACK)
        surf.blit(name_label, (input_rect.x + 10, input_rect.y + 7))

        # Avatar Picker
        draw_text_center(surf, "2. Î”Î¹Î¬Î»ÎµÎ¾Îµ Avatar:", 200, font, BLACK)
        
        for i, rect in enumerate(self.avatar_rects):
            color = PURPLE if i == self.selected_avatar else LIGHT_GREY
            
            if rect.collidepoint(pygame.mouse.get_pos()):
                 color = LIGHT_BLUE
                 
            pygame.draw.rect(surf, color, rect, border_radius=8)
            pygame.draw.rect(surf, DARK_PURPLE, rect, 2, border_radius=8)
            
            avatar_label = avatar_font.render(AVATAR_ICONS[i], True, BLACK)
            surf.blit(avatar_label, (rect.x + 5, rect.y - 2))

        # Buttons
        self.start_button.draw(surf)
        self.quit_button.draw(surf) # **ÎÎ•ÎŸ** ÎšÎ¿Ï…Î¼Ï€Î¯ ÎµÎ¾ÏŒÎ´Î¿Ï…
        
        # Error Message
        if self.error_message:
            draw_text_center(surf, self.error_message, 400, small_font, RED)

        # Scores Card
        self.draw_scores_card(surf)

    def handle_event(self, event):
        if event.type == pygame.MOUSEBUTTONDOWN:
            mouse_pos = event.pos
            
            # ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÎºÎ»Î¹Îº Avatar
            for i, rect in enumerate(self.avatar_rects):
                if rect.collidepoint(mouse_pos):
                    self.selected_avatar = i
                    break

            # ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÎºÎ»Î¹Îº START Button
            if self.start_button.check(mouse_pos):
                player_name = self.login_text.strip()
                if player_name:
                    if player_name not in self.players_data:
                        self.players_data[player_name] = {
                            'score': DEFAULT_SCORE,
                            'streak': DEFAULT_STREAK,
                            'plant_level': DEFAULT_PLANT_LEVEL,
                            'avatar': self.selected_avatar 
                        }
                        save_progress(self.players_data)
                    self.running = False
                    return player_name
                else:
                    self.error_message = "Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Î­Î½Î± ÏŒÎ½Î¿Î¼Î±."
            
            # **ÎÎ•ÎŸ** ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÎºÎ»Î¹Îº QUIT Button
            if self.quit_button.check(mouse_pos):
                pygame.quit()
                sys.exit()
                    
        if event.type == pygame.KEYDOWN:
            if event.key == pygame.K_BACKSPACE:
                self.login_text = self.login_text[:-1]
            elif event.key == pygame.K_RETURN:
                if self.login_text.strip():
                    return self.handle_event(pygame.event.Event(pygame.MOUSEBUTTONDOWN, {'pos': self.start_button.rect.center}))
                else:
                    self.error_message = "Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Î­Î½Î± ÏŒÎ½Î¿Î¼Î±."
            elif event.unicode.isalnum() or event.unicode in (' ', '_'):
                if len(self.login_text) < 15:
                    self.login_text += event.unicode
        
        return None

# ---------------------------------------------------------
# ğŸŸ¢ GAME CLASS (Î¤Î¡ÎŸÎ ÎŸÎ ÎŸÎ™Î—ÎœÎ•ÎÎ— Î“Î™Î‘ SPLASH SCREEN)
# ---------------------------------------------------------

class MagicGardenGame:
    def __init__(self):
        # **Î‘Î›Î›Î‘Î“Î—:** Î‘ÏÏ‡Î¹ÎºÎ® ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· "splash"
        self.state = "splash" 
        self.splash_start_time = pygame.time.get_ticks()
        self.splash_duration = 3000 # 3 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
        
        self.current_player = None
        self.players_data = load_progress() 
        
        self.score = 0
        self.streak = 0
        self.plant_level = 0
        self.avatar_index = 0
        
        self.animation = None
        self.animation_timer = 0
        self.animation_duration = 500
        
        self.login_screen = LoginScreen(self.players_data) 
        
        self.generate_question()
        self.answer_text = ""

    def load_player_data(self, player_name):
        self.current_player = player_name
        data = self.players_data.get(player_name, {})
        
        self.score = data.get('score', DEFAULT_SCORE)
        self.streak = data.get('streak', DEFAULT_STREAK)
        self.plant_level = data.get('plant_level', DEFAULT_PLANT_LEVEL)
        self.avatar_index = data.get('avatar', 0) 
        
        self.generate_question()
        self.state = "playing"

    def save_player_data(self):
        if self.current_player:
            self.players_data[self.current_player]['score'] = self.score
            self.players_data[self.current_player]['streak'] = self.streak
            self.players_data[self.current_player]['plant_level'] = self.plant_level
            save_progress(self.players_data)
        
    def generate_question(self):
        a = random.randint(1,12)
        b = random.randint(1,10)
        self.current_q = (a, b)
        self.correct_answer = a * b

    def submit_answer(self):
        if not self.answer_text: return
        try:
            ans = int(self.answer_text)
        except ValueError: return

        if ans == self.correct_answer:
            sound_correct.play()
            self.score += 1
            self.streak += 1
            
            self.animation = "correct_burst" 
            self.animation_timer = pygame.time.get_ticks()

            if self.streak % 3 == 0 and self.plant_level < MAX_PLANT_LEVEL:
                self.plant_level += 1
                self.animation = "grow" 
                self.animation_timer = pygame.time.get_ticks()
            
            self.save_player_data() 

        else:
            sound_wrong.play()
            self.streak = 0
            self.animation = "wrong"
            self.animation_timer = pygame.time.get_ticks()

        self.generate_question()
        self.answer_text = ""

# ... (ÎŸÎ¹ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ animation Ï€Î±ÏÎ±Î¼Î­Î½Î¿Ï…Î½ Î¯Î´Î¹ÎµÏ‚) ...
def draw_success_animation(surf, x, y, progress):
    size = int(180 * (1 - progress))
    alpha = int(255 * (1 - progress)**2)
    sparkle = pygame.Surface((size*2, size*2), pygame.SRCALPHA)
    pygame.draw.circle(sparkle, (255,255,0,alpha), (size,size), size)
    surf.blit(sparkle, (x - size, y - size))

def draw_correct_burst(surf, x, y, progress):
    if progress >= 1: return
    radius = int(20 * (1 - progress))
    alpha = int(255 * (1 - progress))
    pygame.draw.circle(surf, (255, 255, 100, alpha), (x, y), radius)
    num_particles = 10
    for i in range(num_particles):
        angle = (i / num_particles) * 360
        speed = 100 * progress
        length = speed + random.randint(0, 10) 
        rad = pygame.math.Vector2(1, 0).rotate(angle).normalize() 
        px = x + rad.x * length * (1 - progress) 
        py = y + rad.y * length * (1 - progress) 
        size = int(8 * (1 - progress))
        pygame.draw.rect(surf, GOLD, (px - size//2, py - size//2, size, size))
        
def apply_shake(x, strength, progress):
    offset = int(strength * (1 - progress) * (2 - progress))
    return x + random.randint(-offset, offset)

def draw_growth_pop(surf, x, y, progress):
    size = int(50 + 60 * progress)
    alpha = int(200 * (1 - progress))
    bubble = pygame.Surface((size*2, size*2), pygame.SRCALPHA)
    pygame.draw.circle(bubble, (100,255,100,alpha), (size,size), size)
    surf.blit(bubble, (x - size, y - size))
# --- Î¤Î•Î›ÎŸÎ£ ANIMATION FUNCTIONS ---

# ---------------------------------------------------------
# ğŸŸ¢ MAIN GAME LOOP 
# ---------------------------------------------------------

SHAKE_X_START = 280 
PLANTS = [ "ğŸŒ± Seed", "ğŸŒ¿ Sprout", "ğŸŒµ Baby Cactus", "ğŸŒ´ Small Palm", "ğŸŒ³ Big Tree" ]
MAX_PLANT_LEVEL = len(PLANTS) - 1

game = MagicGardenGame()
clock = pygame.time.Clock()
running = True

while running:
    
    # --- Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Events ---
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            game.save_player_data() 
            running = False
        
        # --- LOGIN STATE ---
        if game.state == "login":
            player_name = game.login_screen.handle_event(event)
            if player_name:
                game.load_player_data(player_name)
        
        # --- PLAYING STATE ---
        elif game.state == "playing":
            if event.type == pygame.KEYDOWN:
                if event.key == pygame.K_BACKSPACE:
                    game.answer_text = game.answer_text[:-1]
                elif event.key == pygame.K_RETURN:
                    game.submit_answer()
                elif event.unicode.isdigit():
                    if len(game.answer_text) < 4:
                        game.answer_text += event.unicode

    # ------------------ DRAWING ------------------
    
    # --- SPLASH SCREEN ---
    if game.state == "splash":
        if BACKGROUND_IMAGE:
            screen.blit(BACKGROUND_IMAGE, (0, 0))
        else:
            screen.fill(LIGHT_BLUE)
            draw_text_center(screen, "Magic Garden", HEIGHT // 2, big_font, BLACK)
            
        # ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Ï‡ÏÏŒÎ½Î¿Ï…
        if pygame.time.get_ticks() - game.splash_start_time > game.splash_duration:
            game.state = "login" # ÎœÎµÏ„Î¬Î²Î±ÏƒÎ· ÏƒÏ„Î·Î½ Î¿Î¸ÏŒÎ½Î· ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚

    # --- LOGIN ---
    elif game.state == "login":
        game.login_screen.draw(screen)

    # --- PLAYING ---
    elif game.state == "playing":
        
        if BACKGROUND_IMAGE:
            screen.blit(BACKGROUND_IMAGE, (0, 0))
        else:
            screen.fill((230,245,255))

        # Avatar Ï„Î¿Ï… Î Î±Î¯ÎºÏ„Î·
        avatar_text = big_font.render(AVATAR_ICONS[game.avatar_index], True, DARK_PURPLE)
        screen.blit(avatar_text, (20, 20))
        
        # background elements
        draw_text(screen, f"Î Î±Î¯ÎºÏ„Î·Ï‚: {game.current_player}", (80, 40), small_font, BLACK)
        draw_text(screen, f"Î¦Ï…Ï„ÏŒ: {PLANTS[game.plant_level]}", (20, 100), small_font, GREEN)
        draw_text(screen, f"Î£ÎºÎ¿Ï: {game.score}", (680, 20), small_font, PURPLE)
        draw_text(screen, f"Streak: {game.streak}", (680, 50), small_font, PURPLE)

        # animation logic
        shake_x = SHAKE_X_START
        if game.animation:
            elapsed = pygame.time.get_ticks() - game.animation_timer
            progress = elapsed / game.animation_duration
            
            if progress >= 1:
                game.animation = None
            else:
                if game.animation == "correct_burst":
                    draw_correct_burst(screen, WIDTH // 2, 180, progress)
                if game.animation == "wrong":
                    shake_x = apply_shake(SHAKE_X_START, 10, progress)
                if game.animation == "grow":
                    draw_growth_pop(screen, 130, 120, progress)
        
        # ğŸŒ³ Î£Ï‡ÎµÎ´Î¯Î±ÏƒÎ· Ï„Î¿Ï… Î¦Ï…Ï„Î¿Ï 
        plant_icon = big_font.render(PLANTS[game.plant_level].split(' ')[0], True, BLACK)
        screen.blit(plant_icon, (150, 80))
        
        # question
        a, b = game.current_q
        question_text = big_font.render(f"{a} x {b} = ?", True, BLACK)
        q_rect = question_text.get_rect(center=(WIDTH // 2 + (shake_x - SHAKE_X_START), 180))
        screen.blit(question_text, q_rect)

        # answer box
        answer_box_w, answer_box_h = 200, 80
        answer_box_x = (WIDTH - answer_box_w) // 2 + (shake_x - SHAKE_X_START)
        answer_box_y = 260
        
        pygame.draw.rect(screen, WHITE, (answer_box_x, answer_box_y, answer_box_w, answer_box_h), border_radius=10)
        
        answer_label = big_font.render(game.answer_text, True, BLACK)
        ans_rect = answer_label.get_rect(center=(answer_box_x + answer_box_w // 2, answer_box_y + answer_box_h // 2))
        screen.blit(answer_label, ans_rect)

        draw_text(screen, "Î Î±Ï„Î®ÏƒÏ„Îµ ENTER Î³Î¹Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·", (answer_box_x, 360), small_font, BLACK)


    pygame.display.update()
    clock.tick(60)

# Î•Î¾Î±ÏƒÏ†Î¬Î»Î¹ÏƒÎ· Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚ ÏŒÏ„Î±Î½ ÎºÎ»ÎµÎ¯Î½ÎµÎ¹ Ï„Î¿ Ï€Î±Î¹Ï‡Î½Î¯Î´Î¹
game.save_player_data()
pygame.quit()
sys.exit()
