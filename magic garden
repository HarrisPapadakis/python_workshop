# magic_garden_cartoon.py
# Î Î±Î¹Ï‡Î½Î¯Î´Î¹ "ÎœÎ±Î³Î¹ÎºÏŒÏ‚ ÎšÎ®Ï€Î¿Ï‚" - ÎšÎ±ÏÏ„Î¿Ï…Î½Î¯ÏƒÏ„Î¹ÎºÎ¿ (pygame)
# Î‘Ï€Î±ÏÎ±Î¯Ï„Î·Ï„ÎµÏ‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚: pygame, numpy
# pip install pygame numpy

import pygame
import random
import json
import os
import sys
from datetime import datetime

# Î ÏÎ¿ÏƒÏ€Î±Î¸Î¿ÏÎ¼Îµ Î½Î± ÎµÎ¹ÏƒÎ¬Î³Î¿Ï…Î¼Îµ numpy Î³Î¹Î± Î½Î± Ï†Ï„Î¹Î¬Î¾Î¿Ï…Î¼Îµ Î®Ï‡Î¿Ï…Ï‚ Î±Ï€ÏŒ ÎºÏÎ¼Î±Ï„Î±.
try:
Â  Â  import numpy as np
except Exception as e:
Â  Â  print("Î‘Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ numpy Î³Î¹Î± Ï„Î¿Ï…Ï‚ ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Î¿Ï…Ï‚ Î®Ï‡Î¿Ï…Ï‚.")
Â  Â  print("Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·: pip install numpy")
Â  Â  raise

# ---------------- Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ ----------------
WIDTH, HEIGHT = 1000, 700
FPS = 40
PROGRESS_FILE = ".magic_garden_progress.json"

# ---------------- Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Pygame ----------------
pygame.init()
pygame.mixer.init()
screen = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("ÎœÎ±Î³Î¹ÎºÏŒÏ‚ ÎšÎ®Ï€Î¿Ï‚ - Cartoon Edition ğŸŒ¸")
clock = pygame.time.Clock()

# Î“ÏÎ±Î¼Î¼Î±Ï„Î¿ÏƒÎµÎ¹ÏÎ­Ï‚
def get_font(size, bold=False):
Â  Â  try:
Â  Â  Â  Â  return pygame.font.SysFont("comic sans ms", size, bold=bold)
Â  Â  except:
Â  Â  Â  Â  return pygame.font.SysFont(None, size, bold=bold)

BIG = get_font(48, bold=True)
MED = get_font(28)
SMALL = get_font(20)

# ---------------- Î§ÏÏÎ¼Î±Ï„Î± ÎºÎ±ÏÏ„Î¿Ï…Î½Î¯ÏƒÏ„Î¹ÎºÎ± ----------------
BG = (252, 240, 255) Â  Â  Â  Â  Â  Â # Î±Ï€Î±Î»ÏŒ ÏÎ¿Î¶-Î¼Î¿Î²
CARD = (255, 255, 255)
TITLE = (120, 20, 150)
BUTTON_BG = (255, 180, 220)
BUTTON_HOVER = (255, 140, 190)
TEXT = (40, 20, 50)
PLANT_GREEN = (80, 200, 120)
DARK_GREEN = (10,140,40)
POT_BROWN = (130,80,40)
YELLOW = (255, 224, 102)
LIGHT = (255,255,204)

# ---------------- Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· / Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Ï€ÏÎ¿ÏŒÎ´Î¿Ï… ----------------
def load_progress():
Â  Â  if os.path.exists(PROGRESS_FILE):
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  with open(PROGRESS_FILE, "r", encoding="utf-8") as f:
Â  Â  Â  Â  Â  Â  Â  Â  return json.load(f)
Â  Â  Â  Â  except:
Â  Â  Â  Â  Â  Â  return {}
Â  Â  return {}

def save_progress(data):
Â  Â  try:
Â  Â  Â  Â  with open(PROGRESS_FILE, "w", encoding="utf-8") as f:
Â  Â  Â  Â  Â  Â  json.dump(data, f, ensure_ascii=False, indent=2)
Â  Â  except Exception as e:
Â  Â  Â  Â  print("Î£Ï†Î¬Î»Î¼Î± Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚:", e)

progress = load_progress()
progress.setdefault("total_played", 0)
progress.setdefault("total_correct", 0)
progress.setdefault("by_table", {})
progress.setdefault("history", [])

# ---------------- Î—Ï‡Î·Ï„Î¹ÎºÏŒÏ‚ Î“ÎµÎ½Î½Î®Ï„Î¿ÏÎ±Ï‚ (numpy -> pygame Sound) ----------------
def generate_tone(freq, duration=0.18, volume=0.6, waveform='sine'):
Â  Â  sample_rate = 44100
Â  Â  t = np.linspace(0, duration, int(sample_rate*duration), False)
Â  Â  if waveform == 'sine':
Â  Â  Â  Â  wave = np.sin(freq * t * 2 * np.pi)
Â  Â  elif waveform == 'square':
Â  Â  Â  Â  wave = np.sign(np.sin(freq * t * 2 * np.pi))
Â  Â  elif waveform == 'triangle':
Â  Â  Â  Â  wave = 2*np.arcsin(np.sin(freq*2*np.pi*t))/np.pi
Â  Â  else:
Â  Â  Â  Â  wave = np.sin(freq * t * 2 * np.pi)
Â  Â  audio = (wave * volume * 32767).astype(np.int16)
Â  Â  stereo = np.column_stack((audio, audio))
Â  Â  return pygame.sndarray.make_sound(stereo.copy())

# Î‰Ï‡Î¿Î¹ Ï€Î±Î¹Ï‡Î½Î¹Î´Î¹Î¬ÏÎ¹ÎºÎ¿Î¹
sound_correct = generate_tone(1000, 0.18, 0.6, 'triangle')
sound_wrong Â  = generate_tone(220, 0.28, 0.6, 'square')
sound_click Â  = generate_tone(700, 0.08, 0.45, 'sine')
sound_levelup = generate_tone(1400, 0.25, 0.6, 'sine')
# Î¼Î¹ÎºÏÎ® Î¼ÎµÎ»Ï‰Î´Î¯Î± (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ®)
def play_victory_melody():
Â  Â  # Î±Ï€Î»Î® Î´Î¹Î±Î´Î¿Ï‡Î® Ï„ÏŒÎ½Ï‰Î½
Â  Â  for f,d in [(700,0.09),(900,0.09),(1100,0.12)]:
Â  Â  Â  Â  s = generate_tone(f, d, 0.5, 'triangle')
Â  Â  Â  Â  s.play()
Â  Â  Â  Â  pygame.time.delay(int(d*1000))

# ---------------- UI Components ----------------
class Button:
Â  Â  def __init__(self, x,y,w,h,text, big=False):
Â  Â  Â  Â  self.rect = pygame.Rect(x,y,w,h)
Â  Â  Â  Â  self.text = text
Â  Â  Â  Â  self.big = big
Â  Â  def draw(self, surf):
Â  Â  Â  Â  mx,my = pygame.mouse.get_pos()
Â  Â  Â  Â  hover = self.rect.collidepoint(mx,my)
Â  Â  Â  Â  color = BUTTON_HOVER if hover else BUTTON_BG
Â  Â  Â  Â  pygame.draw.rect(surf, color, self.rect, border_radius=14)
Â  Â  Â  Â  pygame.draw.rect(surf, (255,255,255), self.rect.inflate(-6,-6), border_radius=12)
Â  Â  Â  Â  txt = BIG.render(self.text, True, TITLE) if self.big else MED.render(self.text, True, TITLE)
Â  Â  Â  Â  surf.blit(txt, (self.rect.x + (self.rect.width-txt.get_width())//2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.rect.y + (self.rect.height-txt.get_height())//2))
Â  Â  Â  Â  return hover
Â  Â  def clicked(self, mx,my):
Â  Â  Â  Â  return self.rect.collidepoint(mx,my)

# ---------------- Î Î±Î¹Ï‡Î½Î¯Î´Î¹ ----------------
class MagicGarden:
Â  Â  def __init__(self):
Â  Â  Â  Â  self.state = "menu" Â # menu, playing, results
Â  Â  Â  Â  self.score = 0
Â  Â  Â  Â  self.streak = 0
Â  Â  Â  Â  self.plant_level = 0 Â # 0..4
Â  Â  Â  Â  self.asked = 0
Â  Â  Â  Â  self.current_q = None
Â  Â  Â  Â  self.correct_answer = None
Â  Â  Â  Â  self.answer_text = ""
Â  Â  Â  Â  self.max_questions = 12
Â  Â  Â  Â  self.selected_table = None
Â  Â  Â  Â  self.repeat_pool = []
Â  Â  Â  Â  # animations
Â  Â  Â  Â  self.animation = None Â  Â  Â  Â # "success","wrong","grow"
Â  Â  Â  Â  self.animation_timer = 0
Â  Â  Â  Â  self.animation_duration = 400 Â # ms
Â  Â  Â  Â  # pop visual scale for plant growth
Â  Â  Â  Â  self.plant_pop_scale = 1.0
Â  Â  Â  Â  # fairy guide bobbing
Â  Â  Â  Â  self.fairy_offset = 0
Â  Â  Â  Â  self.fairy_dir = 1
Â  Â  Â  Â  # start time of session
Â  Â  Â  Â  self.start_time = None
Â  Â  Â  Â  self.end_time = None

Â  Â  def pick_question(self):
Â  Â  Â  Â  if self.repeat_pool and random.random() < 0.6:
Â  Â  Â  Â  Â  Â  return random.choice(self.repeat_pool)
Â  Â  Â  Â  if self.selected_table:
Â  Â  Â  Â  Â  Â  return (self.selected_table, random.randint(1,10))
Â  Â  Â  Â  return (random.randint(1,10), random.randint(1,10))

Â  Â  def new_question(self):
Â  Â  Â  Â  a,b = self.pick_question()
Â  Â  Â  Â  self.current_q = (a,b)
Â  Â  Â  Â  self.correct_answer = a*b
Â  Â  Â  Â  self.answer_text = ""
Â  Â  Â  Â  self.asked += 1

Â  Â  def submit_answer(self):
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  val = int(self.answer_text.strip())
Â  Â  Â  Â  except:
Â  Â  Â  Â  Â  Â  return None
Â  Â  Â  Â  correct = (val == self.correct_answer)

Â  Â  Â  Â  progress["total_played"] += 1
Â  Â  Â  Â  key = str(self.current_q[0])
Â  Â  Â  Â  tbl = progress["by_table"].setdefault(key, {"asked":0, "correct":0})
Â  Â  Â  Â  tbl["asked"] += 1

Â  Â  Â  Â  # animation timestamp
Â  Â  Â  Â  self.animation_timer = pygame.time.get_ticks()

Â  Â  Â  Â  if correct:
Â  Â  Â  Â  Â  Â  sound_correct.play()
Â  Â  Â  Â  Â  Â  self.score += 1
Â  Â  Â  Â  Â  Â  self.streak += 1
Â  Â  Â  Â  Â  Â  tbl["correct"] += 1
Â  Â  Â  Â  Â  Â  progress["total_correct"] += 1

Â  Â  Â  Â  Â  Â  # success animation
Â  Â  Â  Â  Â  Â  self.animation = "success"

Â  Â  Â  Â  Â  Â  # plant growth on streak
Â  Â  Â  Â  Â  Â  if self.streak % 3 == 0 and self.plant_level < 4:
Â  Â  Â  Â  Â  Â  Â  Â  self.plant_level += 1
Â  Â  Â  Â  Â  Â  Â  Â  self.animation = "grow"
Â  Â  Â  Â  Â  Â  Â  Â  sound_levelup.play()
Â  Â  Â  Â  Â  Â  Â  Â  # slightly larger pop
Â  Â  Â  Â  Â  Â  Â  Â  self.plant_pop_scale = 1.25
Â  Â  Â  Â  Â  Â  Â  Â  # small victory melody occasionally
Â  Â  Â  Â  Â  Â  Â  Â  if self.plant_level == 4:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  play_victory_melody()
Â  Â  Â  Â  Â  Â  # reduce repeat_pool if present
Â  Â  Â  Â  Â  Â  if self.current_q in self.repeat_pool:
Â  Â  Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.repeat_pool.remove(self.current_q)
Â  Â  Â  Â  Â  Â  Â  Â  except:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pass
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  sound_wrong.play()
Â  Â  Â  Â  Â  Â  self.streak = 0
Â  Â  Â  Â  Â  Â  if self.plant_level > 0:
Â  Â  Â  Â  Â  Â  Â  Â  self.plant_level -= 1
Â  Â  Â  Â  Â  Â  self.animation = "wrong"
Â  Â  Â  Â  Â  Â  # add to repeat pool (more weight)
Â  Â  Â  Â  Â  Â  self.repeat_pool += [self.current_q]*2

Â  Â  Â  Â  progress["history"].append({
Â  Â  Â  Â  Â  Â  "time": datetime.now().isoformat(),
Â  Â  Â  Â  Â  Â  "question": f"{self.current_q[0]}x{self.current_q[1]}",
Â  Â  Â  Â  Â  Â  "given": val,
Â  Â  Â  Â  Â  Â  "correct": self.correct_answer,
Â  Â  Â  Â  Â  Â  "ok": correct
Â  Â  Â  Â  })
Â  Â  Â  Â  save_progress(progress)
Â  Â  Â  Â  return correct

Â  Â  def update_fairy(self):
Â  Â  Â  Â  # Î¼Î¹ÎºÏÏŒ bobbing animation Î³Î¹Î± Ï„Î· Î½ÎµÏÎ¬Î¹Î´Î± (fairy)
Â  Â  Â  Â  self.fairy_offset += 0.6 * self.fairy_dir
Â  Â  Â  Â  if abs(self.fairy_offset) > 8:
Â  Â  Â  Â  Â  Â  self.fairy_dir *= -1

game = MagicGarden()

# Buttons
btn_start = Button(60, 480, 260, 80, "ÎÎµÎºÎ¯Î½Î± Î Î±Î¹Ï‡Î½Î¯Î´Î¹", big=True)
btn_all = Button(60, 180, 260, 60, "ÎŒÎ»ÎµÏ‚ Î¿Î¹ Ï€ÏÎ¿Ï€Î±Î¯Î´ÎµÎ¹ÎµÏ‚")
table_buttons = [Button(360 + i*110, 180, 90, 60, str(i)) for i in range(1,11)]
btn_quit = Button(WIDTH-220, HEIGHT-110, 180, 70, "ÎˆÎ¾Î¿Î´Î¿Ï‚", big=True)
btn_menu_back = Button(60, 580, 200, 60, "Î Î¯ÏƒÏ‰ ÏƒÏ„Î¿ ÎœÎµÎ½Î¿Ï")

# ---------------- Cartoon Fairy / Guide ----------------
def draw_fairy(surf, x, y, offset):
Â  Â  # Î±Ï€Î»ÏŒ ÎºÎ±ÏÏ„Î¿ÏÎ½ ÏƒÏ‡Î­Î´Î¹Î¿ Î½ÎµÏÎ¬Î¹Î´Î±Ï‚ Î¼Îµ Ï†Ï„ÎµÏÎ¬
Â  Â  cx, cy = x, y + int(offset)
Â  Â  # Ï†Ï„ÎµÏÎ¬
Â  Â  wing = pygame.Surface((150,120), pygame.SRCALPHA)
Â  Â  pygame.draw.ellipse(wing, (255,240,255,190), (0,10,110,80))
Â  Â  pygame.draw.ellipse(wing, (230,220,255,190), (40,0,110,80))
Â  Â  surf.blit(wing, (cx-70, cy-40))
Â  Â  # ÏƒÏÎ¼Î±
Â  Â  pygame.draw.circle(surf, (255,220,240), (cx, cy), 28)
Â  Â  # Î¼Î±Î»Î»Î¹Î¬
Â  Â  pygame.draw.polygon(surf, (255,190,240), [(cx-28,cy-8),(cx-6,cy-22),(cx+20,cy-8)])
Â  Â  # Î¼Î¬Ï„Î¹Î± & Ï‡Î±Î¼ÏŒÎ³ÎµÎ»Î¿
Â  Â  pygame.draw.rect(surf, (30,30,30), (cx-8,cy-4,5,5))
Â  Â  pygame.draw.rect(surf, (30,30,30), (cx+4,cy-4,5,5))
Â  Â  pygame.draw.arc(surf, (30,30,30), (cx-12,cy,24,16), 3.14, 2*3.14, 2)

# ---------------- Animations (drawing helpers) ----------------
def draw_success_animation(surf, x, y, progress):
Â  Â  # Î»Î±Î¼Ï€ÎµÏÏŒÏ‚ ÎºÏÎºÎ»Î¿Ï‚ Ï€Î¿Ï… ÏƒÎ²Î®Î½ÎµÎ¹ ÎºÎ±Î¹ Î¼Î¹ÎºÏÎ¬ Î±ÏƒÏ„Î­ÏÎ¹Î±
Â  Â  alpha = max(0, int(255 * (1 - progress)))
Â  Â  radius = int(130 * (1 - progress) + 10)
Â  Â  s = pygame.Surface((radius*2, radius*2), pygame.SRCALPHA)
Â  Â  pygame.draw.circle(s, (255,250,150, alpha), (radius, radius), radius)
Â  Â  surf.blit(s, (x - radius, y - radius))
Â  Â  # starlets
Â  Â  for i in range(6):
Â  Â  Â  Â  ang = i * (360/6) + progress*360*2
Â  Â  Â  Â  sx = int(x + (radius//2) * random.uniform(0.6,1.0) * math_cos(ang))
Â  Â  Â  Â  sy = int(y + (radius//2) * random.uniform(0.6,1.0) * math_sin(ang))
Â  Â  Â  Â  pygame.draw.circle(surf, (255,240,200, max(20, alpha//2)), (sx,sy), 4)

def apply_shake(x, strength, progress):
Â  Â  # ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ offset x ÏÏƒÏ„Îµ Ï„Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î½Î± "Ï„ÏÎ¿Î¼Î¬Î¶ÎµÎ¹"
Â  Â  max_off = int(strength * (1 - progress))
Â  Â  return x + random.randint(-max_off, max_off)

def draw_growth_pop(surf, x, y, progress):
Â  Â  # Ï€ÏÎ¬ÏƒÎ¹Î½Î· Ï†Î¿ÏÏƒÎºÎ± Ï€Î¿Ï… Î¼ÎµÎ³Î±Î»ÏÎ½ÎµÎ¹ ÎºÎ±Î¹ ÎµÎ¾Î±Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹
Â  Â  size = int(20 + 80 * progress)
Â  Â  alpha = int(200 * (1 - progress))
Â  Â  s = pygame.Surface((size*2, size*2), pygame.SRCALPHA)
Â  Â  pygame.draw.circle(s, (180,255,180, alpha), (size, size), size)
Â  Â  pygame.draw.circle(s, (255,255,255, alpha//3), (int(size*0.6), int(size*0.6)), int(size*0.3))
Â  Â  surf.blit(s, (x-size, y-size))

# Î¼Î¹ÎºÏÎ­Ï‚ Î²Î¿Î·Î¸Î·Ï„Î¹ÎºÎ­Ï‚ Î³Î¹Î± trig functions Ï‡Ï‰ÏÎ¯Ï‚ Ï€Î¿Î»Î»Î¬ imports
import math
def math_cos(d): return math.cos(math.radians(d))
def math_sin(d): return math.sin(math.radians(d))

# ---------------- Î£Ï‡ÎµÎ´Î¯Î±ÏƒÎ· Ï†Ï…Ï„Î¿Ï (cartoon, Î¼Îµ ÎµÏ€Î¯Ï€ÎµÎ´Î±) ----------------
def draw_cartoon_plant(surf, level, center_x, center_y, pop_scale=1.0):
Â  Â  # Î¶Ï‰Î³ÏÎ±Ï†Î¯Î¶Î¿Ï…Î¼Îµ ÎºÎ±ÏÏ„Î¿Ï…Î½Î¯ÏƒÏ„Î¹ÎºÎ¿ Î´Î¿Ï‡ÎµÎ¯Î¿ ÎºÎ±Î¹ Ï†Ï…Ï„ÏŒ
Â  Â  # pot
Â  Â  pot_w = int(220 * pop_scale)
Â  Â  pot_h = int(90 * pop_scale)
Â  Â  pot = pygame.Rect(center_x - pot_w//2, center_y + 80, pot_w, pot_h)
Â  Â  pygame.draw.rect(surf, POT_BROWN, pot, border_radius=16)
Â  Â  pygame.draw.rect(surf, (160,110,70), pot.inflate(-20,-22), border_radius=12)
Â  Â  # roots / soil shine
Â  Â  pygame.draw.ellipse(surf, (90,60,40), (pot.x+10, pot.y-10, pot.width-20, 30))
Â  Â  # plant parts by level
Â  Â  base_x = center_x
Â  Â  base_y = center_y + 60
Â  Â  # stalk
Â  Â  if level >= 1:
Â  Â  Â  Â  pygame.draw.line(surf, DARK_GREEN, (base_x, base_y+30), (base_x, base_y-10), 12)
Â  Â  Â  Â  pygame.draw.circle(surf, PLANT_GREEN, (base_x, base_y-22), 18)
Â  Â  if level >= 2:
Â  Â  Â  Â  pygame.draw.line(surf, DARK_GREEN, (base_x, base_y+10), (base_x-35, base_y-5), 9)
Â  Â  Â  Â  pygame.draw.circle(surf, PLANT_GREEN, (base_x-36, base_y-18), 14)
Â  Â  if level >= 3:
Â  Â  Â  Â  pygame.draw.line(surf, DARK_GREEN, (base_x, base_y+10), (base_x+36, base_y-5), 9)
Â  Â  Â  Â  pygame.draw.circle(surf, PLANT_GREEN, (base_x+36, base_y-18), 14)
Â  Â  if level >= 4:
Â  Â  Â  Â  pygame.draw.line(surf, DARK_GREEN, (base_x, base_y+30), (base_x, base_y-80), 14)
Â  Â  Â  Â  pygame.draw.polygon(surf, PLANT_GREEN, [(base_x, base_y-80),(base_x-70, base_y-20),(base_x+70, base_y-20)])
Â  Â  # cute face on pot
Â  Â  eye_y = pot.y + 20
Â  Â  pygame.draw.circle(surf, (255,255,255), (pot.centerx-30, eye_y), 8)
Â  Â  pygame.draw.circle(surf, (255,255,255), (pot.centerx+30, eye_y), 8)
Â  Â  pygame.draw.circle(surf, (20,20,20), (pot.centerx-30, eye_y), 3)
Â  Â  pygame.draw.circle(surf, (20,20,20), (pot.centerx+30, eye_y), 3)
Â  Â  pygame.draw.arc(surf, (180,50,120), (pot.centerx-20, pot.y+28, 40, 20), math.radians(10), math.radians(170), 3)

# ---------------- Main Loop ----------------
game = MagicGarden()
game.new_question()

running = True
while running:
Â  Â  dt = clock.tick(FPS)
Â  Â  mx,my = pygame.mouse.get_pos()

Â  Â  # Î•ÎºÎ´Î·Î»ÏÏƒÎµÎ¹Ï‚
Â  Â  for event in pygame.event.get():
Â  Â  Â  Â  if event.type == pygame.QUIT:
Â  Â  Â  Â  Â  Â  running = False

Â  Â  Â  Â  if game.state == "menu":
Â  Â  Â  Â  Â  Â  if event.type == pygame.MOUSEBUTTONDOWN:
Â  Â  Â  Â  Â  Â  Â  Â  if btn_start.clicked(mx,my):
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sound_click.play()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game = MagicGarden()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.selected_table = None
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.new_question()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.state = "playing"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.start_time = datetime.now().isoformat()
Â  Â  Â  Â  Â  Â  Â  Â  if btn_all.clicked(mx,my):
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sound_click.play()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game = MagicGarden()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.selected_table = None
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.new_question()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.state = "playing"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.start_time = datetime.now().isoformat()
Â  Â  Â  Â  Â  Â  Â  Â  for idx,b in enumerate(table_buttons, start=1):
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if b.clicked(mx,my):
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sound_click.play()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game = MagicGarden()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.selected_table = idx
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.new_question()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.state = "playing"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.start_time = datetime.now().isoformat()
Â  Â  Â  Â  Â  Â  Â  Â  if btn_quit.clicked(mx,my):
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sound_click.play()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  running = False

Â  Â  Â  Â  elif game.state == "playing":
Â  Â  Â  Â  Â  Â  if event.type == pygame.KEYDOWN:
Â  Â  Â  Â  Â  Â  Â  Â  if event.key == pygame.K_BACKSPACE:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.answer_text = game.answer_text[:-1]
Â  Â  Â  Â  Â  Â  Â  Â  elif event.key == pygame.K_RETURN:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  res = game.submit_answer()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  # Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ Ï…Ï€Î¿Î²Î¿Î»Î®, Î±Î½ Ï„ÎµÎ»ÎµÎ¯Ï‰ÏƒÎµ Î³ÏÏÎ¿Ï‚
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if game.asked >= game.max_questions:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.end_time = datetime.now().isoformat()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.state = "results"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.new_question()
Â  Â  Â  Â  Â  Â  Â  Â  elif event.unicode.isdigit():
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if len(game.answer_text) < 4:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  game.answer_text += event.unicode
Â  Â  Â  Â  Â  Â  if event.type == pygame.MOUSEBUTTONDOWN:
Â  Â  Â  Â  Â  Â  Â  Â  if btn_quit.clicked(mx,my):
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sound_click.play()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  running = False

Â  Â  Â  Â  elif game.state == "results":
Â  Â  Â  Â  Â  Â  if event.type == pygame.MOUSEBUTTONDOWN:
Â  Â  Â  Â  Â  Â  Â  Â  # ÎºÎ»Î¹Îº Ï€Î¬ÏÎ¿Î´Î¿Ï‚: ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ Î¼ÎµÎ½Î¿Ï
Â  Â  Â  Â  Â  Â  Â  Â  sound_click.play()
Â  Â  Â  Â  Â  Â  Â  Â  game.state = "menu"
Â  Â  Â  Â  Â  Â  if event.type == pygame.KEYDOWN and event.key == pygame.K_ESCAPE:
Â  Â  Â  Â  Â  Â  Â  Â  running = False

Â  Â  # Update Î¼Î¹ÎºÏÏÎ½ ÎºÎ¹Î½Î®ÏƒÎµÏ‰Î½
Â  Â  if game.state == "playing":
Â  Â  Â  Â  game.update_fairy()
Â  Â  Â  Â  # decay pop scale
Â  Â  Â  Â  if game.plant_pop_scale > 1.0:
Â  Â  Â  Â  Â  Â  game.plant_pop_scale -= 0.01
Â  Â  Â  Â  Â  Â  if game.plant_pop_scale < 1.0:
Â  Â  Â  Â  Â  Â  Â  Â  game.plant_pop_scale = 1.0

Â  Â  # Î£Ï‡ÎµÎ´Î¯Î±ÏƒÎ· Î¿Î¸ÏŒÎ½Î·Ï‚
Â  Â  screen.fill(BG)

Â  Â  # ----- MENU -----
Â  Â  if game.state == "menu":
Â  Â  Â  Â  # Ï„Î¯Ï„Î»Î¿Ï‚ ÎºÎ±ÏÏ„Î¿Ï…Î½Î¯ÏƒÏ„Î¹ÎºÎ¿Ï‚
Â  Â  Â  Â  pygame.draw.ellipse(screen, LIGHT, (40,20,920,120))
Â  Â  Â  Â  title_surf = BIG.render("ÎœÎ‘Î“Î™ÎšÎŸÎ£ ÎšÎ—Î ÎŸÎ£ Î Î¡ÎŸÎ Î‘Î™Î”Î•Î™Î©Î ğŸŒŸ", True, TITLE)
Â  Â  Â  Â  screen.blit(title_surf, (60,40))
Â  Â  Â  Â  subtitle = MED.render("Î”Î¹Î±ÏƒÎºÎ­Î´Î±ÏƒÎ· & Î¼Î¬Î¸Î·ÏƒÎ· â€” Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï€ÏÎ¿Ï€Î±Î¯Î´ÎµÎ¹Î± Î® ÏŒÎ»ÎµÏ‚", True, TEXT)
Â  Â  Â  Â  screen.blit(subtitle, (60,110))

Â  Â  Â  Â  # fairy Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬
Â  Â  Â  Â  draw_fairy(screen, 140, 300, game.fairy_offset)

Â  Â  Â  Â  # ÎºÎ±ÏÏ„Î­Î»ÎµÏ‚ ÎµÏ€Î¹Î»Î¿Î³Î®Ï‚
Â  Â  Â  Â  btn_all.draw(screen)
Â  Â  Â  Â  for b in table_buttons:
Â  Â  Â  Â  Â  Â  b.draw(screen)
Â  Â  Â  Â  btn_start.draw(screen)
Â  Â  Â  Â  btn_quit.draw(screen)

Â  Â  Â  Â  # progress summary
Â  Â  Â  Â  pygame.draw.rect(screen, CARD, (60,270,400,180), border_radius=16)
Â  Â  Â  Â  draw_text = SMALL.render
Â  Â  Â  Â  screen.blit(MED.render("Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬", True, TITLE), (80,280))
Â  Â  Â  Â  screen.blit(SMALL.render(f"Î£Ï…Î½Î¿Î»Î¹ÎºÎ­Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚: {progress['total_played']}", True, TEXT), (80,320))
Â  Â  Â  Â  screen.blit(SMALL.render(f"Î£Ï‰ÏƒÏ„Î­Ï‚: {progress['total_correct']}", True, TEXT), (80,350))
Â  Â  Â  Â  screen.blit(SMALL.render("Î•Ï€Î¯Î´Î¿ÏƒÎ· Î±Î½Î¬ Ï€ÏÎ¿Ï€Î±Î¯Î´ÎµÎ¹Î±:", True, TEXT), (80,380))
Â  Â  Â  Â  for i in range(1,11):
Â  Â  Â  Â  Â  Â  s = progress["by_table"].get(str(i), {"asked":0,"correct":0})
Â  Â  Â  Â  Â  Â  screen.blit(SMALL.render(f"{i}x : {s['correct']}/{s['asked']}", True, TEXT), (100, 380 + i*18))

Â  Â  Â  Â  # Î¼Î¹ÎºÏÏŒ tip Î´ÎµÎ¾Î¹Î¬
Â  Â  Â  Â  tip_box = pygame.Rect(500, 270, 420, 180)
Â  Â  Â  Â  pygame.draw.rect(screen, LIGHT, tip_box, border_radius=14)
Â  Â  Â  Â  screen.blit(SMALL.render("Î£Ï…Î¼Î²Î¿Ï…Î»Î® Î³Î¹Î± Î“Î¿Î½ÎµÎ¯Ï‚:", True, TITLE), (520,280))
Â  Â  Â  Â  screen.blit(SMALL.render("- ÎšÎ¬Î½Ï„Îµ 2 Î³ÏÏÎ¿Ï…Ï‚ Ï„Î·Î½ Î·Î¼Î­ÏÎ±", True, TEXT), (520,310))
Â  Â  Â  Â  screen.blit(SMALL.render("- Î•Ï€Î¹Î²ÏÎ±Î²ÎµÏÏƒÏ„Îµ Ï„Î¿ Ï†Ï…Ï„ÏŒ ÏƒÏ„Î¿ 4/4", True, TEXT), (520,340))
Â  Â  Â  Â  screen.blit(SMALL.render("- Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Ï€ÏÎ¿Ï€Î±Î¯Î´ÎµÎ¹Î± Î³Î¹Î± ÏƒÏ„Î¿Ï‡ÎµÏ…Î¼Î­Î½Î· ÎµÎ¾Î¬ÏƒÎºÎ·ÏƒÎ·", True, TEXT), (520,370))

Â  Â  # ----- PLAYING -----
Â  Â  elif game.state == "playing":
Â  Â  Â  Â  # question card
Â  Â  Â  Â  pygame.draw.rect(screen, CARD, (40,30,520,220), border_radius=18)
Â  Â  Â  Â  # handle animation effects
Â  Â  Â  Â  shake_x = 40
Â  Â  Â  Â  if game.animation:
Â  Â  Â  Â  Â  Â  elapsed = pygame.time.get_ticks() - game.animation_timer
Â  Â  Â  Â  Â  Â  progress_anim = elapsed / max(1, game.animation_duration)
Â  Â  Â  Â  Â  Â  if progress_anim >= 1:
Â  Â  Â  Â  Â  Â  Â  Â  game.animation = None
Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  if game.animation == "success":
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draw_success_animation(screen, 300, 130, progress_anim)
Â  Â  Â  Â  Â  Â  Â  Â  if game.animation == "wrong":
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shake_x = apply_shake(40, 12, progress_anim)
Â  Â  Â  Â  Â  Â  Â  Â  if game.animation == "grow":
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draw_growth_pop(screen, WIDTH-170, 170, progress_anim)

Â  Â  Â  Â  # ÎµÏÏÏ„Î·ÏƒÎ·
Â  Â  Â  Â  qtxt = f"{game.current_q[0]} Â Ã— Â {game.current_q[1]} Â = Â ?"
Â  Â  Â  Â  screen.blit(BIG.render(qtxt, True, TITLE), (shake_x, 70))

Â  Â  Â  Â  # input box
Â  Â  Â  Â  input_rect = pygame.Rect(60, 150, 220, 80)
Â  Â  Â  Â  pygame.draw.rect(screen, (255,255,255), input_rect, border_radius=12)
Â  Â  Â  Â  pygame.draw.rect(screen, (230,200,230), input_rect, 4, border_radius=12)
Â  Â  Â  Â  screen.blit(BIG.render(game.answer_text, True, TITLE), (input_rect.x+18, input_rect.y+18))

Â  Â  Â  Â  # little tip and streak
Â  Â  Â  Â  screen.blit(SMALL.render(f"Î£ÎµÎ¹ÏÎ¬ ÏƒÏ‰ÏƒÏ„ÏÎ½: {game.streak}", True, TEXT), (60, 245))
Â  Â  Â  Â  screen.blit(SMALL.render(f"Î£ÎºÎ¿Ï: {game.score} / Î£Ï„ÏŒÏ‡Î¿Ï‚: {game.max_questions}", True, TEXT), (260, 245))

Â  Â  Â  Â  # draw plant big on right
Â  Â  Â  Â  pygame.draw.rect(screen, CARD, (580, 30, 360, 420), border_radius=18)
Â  Â  Â  Â  screen.blit(MED.render("ÎŸ ÎºÎ®Ï€Î¿Ï‚ ÏƒÎ¿Ï…", True, TITLE), (600, 40))
Â  Â  Â  Â  draw_cartoon_plant(screen, game.plant_level, 760, 200, pop_scale=game.plant_pop_scale)
Â  Â  Â  Â  screen.blit(SMALL.render("Î¦Ï…Ï„ÏŒ", True, TEXT), (700, 330))

Â  Â  Â  Â  # buttons: quit
Â  Â  Â  Â  btn_quit.draw(screen)

Â  Â  Â  Â  # repeat-pool indicator
Â  Â  Â  Â  screen.blit(SMALL.render(f"Î•Ï€Î±Î½Î±Î»Î®ÏˆÎµÎ¹Ï‚ ÏƒÎµ Î¿Ï…ÏÎ¬: {len(game.repeat_pool)}", True, TEXT), (600, 370))

Â  Â  # ----- RESULTS -----
Â  Â  elif game.state == "results":
Â  Â  Â  Â  pygame.draw.rect(screen, CARD, (60,40,880,600), border_radius=18)
Â  Â  Â  Â  screen.blit(BIG.render("Î¤Î­Î»Î¿Ï‚ Î“ÏÏÎ¿Ï…!", True, TITLE), (80,60))
Â  Â  Â  Â  screen.blit(MED.render(f"Î£ÎºÎ¿Ï: {game.score} / {game.max_questions}", True, TEXT), (80,140))
Â  Â  Â  Â  pct = int((game.score / max(1, game.max_questions)) * 100)
Â  Â  Â  Â  screen.blit(MED.render(f"Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÏƒÏ‰ÏƒÏ„ÏÎ½: {pct}%", True, TEXT), (80,190))
Â  Â  Â  Â  screen.blit(SMALL.render("Î ÏÏŒÏƒÏ†Î±Ï„Î¿ Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ:", True, TEXT), (80,240))

Â  Â  Â  Â  # ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÎ¹ 8 Ï€Î¹Î¿ Ï€ÏÏŒÏƒÏ†Î±Ï„Î±
Â  Â  Â  Â  y = 280
Â  Â  Â  Â  for h in progress["history"][-8:]:
Â  Â  Â  Â  Â  Â  mark = "âœ“" if h["ok"] else "âœ—"
Â  Â  Â  Â  Â  Â  col = (20,200,120) if h["ok"] else (240,80,80)
Â  Â  Â  Â  Â  Â  screen.blit(SMALL.render(f"{h['question']} â†’ {h['given']} ({h['correct']}) {mark}", True, col), (80, y))
Â  Â  Â  Â  Â  Â  y += 28

Â  Â  Â  Â  screen.blit(SMALL.render("ÎšÎ¬Î½Îµ ÎºÎ»Î¹Îº Î¿Ï€Î¿Ï…Î´Î®Ï€Î¿Ï„Îµ Î³Î¹Î± Î½Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹Ï‚ ÏƒÏ„Î¿ Î¼ÎµÎ½Î¿Ï.", True, TEXT), (80, y+20))
Â  Â  Â  Â  btn_menu_back.draw(screen)
Â  Â  Â  Â  btn_quit.draw(screen)

Â  Â  pygame.display.flip()

pygame.quit()

# ---------------- ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î³Î¹Î± PyInstaller (ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ·) ----------------
# Î‘Î½ Î¸ÎµÏ‚ Î½Î± Ï„Î¿ Î¼ÎµÏ„Î±Ï„ÏÎ­ÏˆÎµÎ¹Ï‚ ÏƒÎµ .exe:
# pip install pyinstaller
# pyinstaller --onefile --windowed magic_garden_cartoon.py
# Î‘Î½ Î¸Î­Î»ÎµÎ¹Ï‚ Î½Î± ÏƒÏ…Î¼Ï€ÎµÏÎ¹Î»Î¬Î²ÎµÎ¹Ï‚ icons/Î®Ï‡Î¿Ï…Ï‚, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ --add-data


